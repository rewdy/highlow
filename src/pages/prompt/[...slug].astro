---
import { getCollection } from "astro:content";
import Layout from "../../components/Layout.astro";
import { rootPath } from "../../constants";
import CardLayout from "../../components/CardLayout.astro";

export async function getStaticPaths() {
  const promptPages = await getCollection("prompts");
  return promptPages.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

// Get all prompts
const allPrompts = await getCollection("prompts");
const totalPrompts = allPrompts.length;

const { entry } = Astro.props;
const { Content } = await entry.render();

const entryNum = Number.parseInt(entry.slug, 10);
---

<CardLayout title={`Prompt ${entry.slug}`}>
  <article class="prompt" transition:animate="slide">
    <div class="prompt-content">
      <Content />
    </div>
    <footer class="d-flex justify-content-between align-items-center">
      <div class="text-muted">
        <div>Prompt #{entry.slug}</div>
      </div>
      <div class="d-flex gap-3 align-items-center">
        {
          entryNum > 1 && (
            <div>
              <a
                href={`${rootPath}prompt/${entryNum - 1}`}
                title="Previous prompt"
                class="directional-link"
              >
                prev
              </a>
            </div>
          )
        }
        {
          entryNum < totalPrompts && (
            <div>
              <a
                href={`${rootPath}prompt/${entryNum + 1}`}
                title="Next prompt"
                class="directional-link"
              >
                next
              </a>
            </div>
          )
        }
        <button id="btn-see-another" type="button" class="m-0">
          See another
        </button>
      </div>
    </footer>
  </article>
</CardLayout>

<script define:vars={{ totalPrompts, rootPath }} is:inline>
  function navigateToRandomPrompt() {
    const randomIndex = Math.floor(Math.random() * totalPrompts);
    const newRoute = `${rootPath}prompt/${randomIndex}`;
    window.location.href = newRoute;
  }

  const btn = document.getElementById("btn-see-another");
  btn.addEventListener("click", navigateToRandomPrompt);
</script>

<style>
  .prompt {
    display: flex;
    flex-direction: column;
    height: 100%;
    justify-content: space-between;
  }
  .prompt-content {
    text-align: center;
    font-size: 2rem;
    line-height: 1.5;
    max-width: 600px;
    margin: 1em auto;
  }
  .directional-link {
    color: var(--pico-muted-color);
  }
</style>
